# Troubleshooting Common Issues

This document provides solutions and explanations for common problems that developers may encounter when working on the Orchestra compiler.

---

### **1. Build Fails with "No such file or directory: ... .inc"**

*   **Symptom:** The C++ compiler fails with an error indicating that a `.h.inc` or `.cpp.inc` file cannot be found. Your IDE might also flag `#include` directives for these files as errors.

*   **Root Cause:** This is expected behavior and a common point of confusion for developers new to MLIR. The `.inc` files are **generated by the build system** from the TableGen (`.td`) definition files. They do not exist in the source tree and are created in the build directory during compilation.

*   **Solution:**
    1.  Ensure you have correctly configured the project with CMake, as described in the main `README.md`.
    2.  Run a full build using `cmake --build orchestra-compiler/build`. The `.inc` files will be generated as part of this process.
    3.  If the error persists after a build, it may indicate a deeper issue in the TableGen definitions themselves. See the next troubleshooting item.

---

### **2. Build Fails with Cryptic C++ Template Errors in Generated Code**

*   **Symptom:** The build fails with a hard-to-understand C++ template error inside a `.cpp.inc` file or a file that includes it (like `OrchestraOps.cpp`). The error might be something like `parse error in template argument list`.

*   **Root Cause:** This almost always indicates an error in a TableGen (`.td`) definition file. When a `.td` file has a mistake (e.g., a missing required attribute, a typo in a trait name), `mlir-tblgen` can generate syntactically incorrect C++ code, which then causes the C++ compiler to fail. The error message from the C++ compiler is often not helpful in diagnosing the root cause in the `.td` file.

*   **Example from `BUILD_ISSUE_ANALYSIS.md`:**
    *   **Problem:** The `Orchestra_CommitOp` was defined with the `AttrSizedOperandSegments` trait. This trait requires the operation to also have a mandatory attribute named `operandSegmentSizes`. This attribute was missing from the op's definition in `OrchestraOps.td`.
    *   **Symptom:** `mlir-tblgen` generated a malformed C++ class for `Orchestra_CommitOp`, leading to a C++ compiler failure.
    *   **Solution:** Add the required `operandSegmentSizes` attribute to the op's definition in the `.td` file.

*   **Debugging Strategy:**
    1.  If you have recently modified a `.td` file, carefully review your changes. Look for missing attributes, typos, or incorrect class/trait usage.
    2.  If you are unsure, try commenting out the operation or interface you recently added in the `.td` file and see if the build succeeds.
    3.  Isolate the problem by commenting out operations one by one in the `addOperations<...>()` call in the dialect's main C++ file (e.g., `OrchestraDialect.cpp`) until the build passes. This will help you identify the specific operation that has the malformed definition.

---

### **3. GPU Lowering Fails or Produces Incorrect Code**

*   **Symptom:** The `--lower-orchestra-to-gpu` pass fails, or the resulting GPU code is incorrect or inefficient.

*   **Root Cause:** The GPU lowering passes are highly sensitive to the target architecture.

*   **Solution:**
    1.  **Check the `sm_arch` attribute:** When lowering to NVGPU, the `LowerOrchestraToNVGPUPass` dispatches to different logic based on the `sm_arch` attribute of the `gpu.module`. If this attribute is missing or incorrect, the pass may generate code for the wrong architecture (e.g., generating TMA instructions for a pre-Blackwell GPU).
    2.  **Ensure you are targeting the correct vendor dialect:** Use the `--gpu-arch` option (e.g., `nvgpu`, `rocdl`) to select the correct lowering path.
